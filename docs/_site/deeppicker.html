<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>DeepPicker - cryo-docs</title> <link rel="shortcut icon" href="/docs/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/docs/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>DeepPicker | cryo-docs</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="DeepPicker" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="/docs/deeppicker.html" /> <meta property="og:url" content="/docs/deeppicker.html" /> <meta property="og:site_name" content="cryo-docs" /> <script type="application/ld+json"> {"url":"/docs/deeppicker.html","headline":"DeepPicker","@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/docs/" class="site-title lh-tight"> cryo-docs </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/docs/" class="nav-list-link">Home</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/docs/pickers" class="nav-list-link">Particle Pickers</a><ul class="nav-list "><li class="nav-list-item "><a href="/docs/aspire-apple.html" class="nav-list-link">ASPIRE APPLEpicker</a></li><li class="nav-list-item "><a href="/docs/autocryopicker.html" class="nav-list-link">AutoCryoPicker</a></li><li class="nav-list-item active"><a href="/docs/deeppicker.html" class="nav-list-link active">DeepPicker</a></li><li class="nav-list-item "><a href="/docs/relion-log.html" class="nav-list-link">RELION LoG (Laplacian-of-Gaussian) Picker</a></li><li class="nav-list-item "><a href="/docs/sphire-cryolo.html" class="nav-list-link">SPHIRE-crYOLO</a></li><li class="nav-list-item "><a href="/docs/topaz.html" class="nav-list-link">Topaz</a></li></ul></li><li class="nav-list-item"><a href="/docs/empiar.html" class="nav-list-link">EMPIAR</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search cryo-docs" aria-label="Search cryo-docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/sebseager/cryo-docs" class="site-button" > cryo-docs on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/docs/pickers">Particle Pickers</a></li> <li class="breadcrumb-nav-list-item"><span>DeepPicker</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="deeppicker"> <a href="#deeppicker" class="anchor-heading" aria-labelledby="deeppicker"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DeepPicker </h1> <h2 id="summary"> <a href="#summary" class="anchor-heading" aria-labelledby="summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Summary </h2> <p>DeepPicker is available as a <a href="https://github.com/nejyeah/DeepPicker-python">GitHub repo</a>. We used Python 3.6 for this installation.</p> <p>The DeepPicker paper can be found <a href="https://arxiv.org/abs/1605.01838">here</a>. Refer also to the <a href="https://github.com/nejyeah/DeepPicker-python/blob/master/README.md">README</a> for more information. The following guide is drawn in part from these resources.</p> <h2 id="compatibility"> <a href="#compatibility" class="anchor-heading" aria-labelledby="compatibility"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Compatibility </h2> <p>We have tested DeepPicker successfully on RHEL (Red Hat Enterprise Linux) 7.7. According to the maintainers,</p> <blockquote> <p>it only supports Ubuntu 12.0+, centOS 7.0+, and RHEL 7.0+</p> </blockquote> <h2 id="installation"> <a href="#installation" class="anchor-heading" aria-labelledby="installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installation </h2> <p>First, clone the DeepPicker repo into <code class="language-plaintext highlighter-rouge">pickers/deeppicker/</code> using</p> <p>```shell script git clone https://github.com/nejyeah/DeepPicker-python.git pickers/deeppicker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
In some cases, we have found that DeepPicker may not run properly as-is. If you would like to apply our patches to DeepPicker, run the script included in `cryo-docs/patches/deeppicker`. This script will replace several DeepPicker source files with our patched versions (keeping the others as cloned in the previous step).

```shell script
sh patches/deeppicker/patch-deeppicker.sh pickers/deeppicker/
</code></pre></div></div> <p>Create and activate a new conda environment using Python version 3.6 (since <code class="language-plaintext highlighter-rouge">tensorflow</code> versions 1.12.0 and earlier do not support Python 3.7).</p> <p>```shell script conda create -n deeppicker matplotlib scipy==1.2.1 python=3.6 conda activate deeppicker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
DeepPicker requires the `tensorflow` machine learning package, which in turn requires `cudatoolkit` and `cudnn` in order to support CUDA-compatible GPUs (if your system already has global installations of CUDA and cuDNN, feel free to skip the following discussion). These can be installed manually, but it is important to use the correct version of each to avoid errors. See [this compatibility chart](https://www.tensorflow.org/install/source#gpu) for more information. The [DeepPicker GitHub](https://github.com/nejyeah/DeepPicker-python#1-install-tensorflow) indicates that `cudatoolkit` 7.5 and `cudnn` 4 should be used, but these versions are quite old and may not be compatible with modern GPU hardware (i.e., CUDA 7.5 does not support Pascal GPUs or later).

To install the latest versions of `tensorflow-gpu` and all its compatible dependencies (including `cudatoolkit` and `cudnn`), use

```shell script
conda install tensorflow-gpu
</code></pre></div></div> <p>or, to specify a <code class="language-plaintext highlighter-rouge">tensorflow-gpu</code> version (which in turn will pull the correct versions of <code class="language-plaintext highlighter-rouge">cudatoolkit</code> and <code class="language-plaintext highlighter-rouge">cudnn</code>), use</p> <p>```shell script conda install tensorflow-gpu=#.##.##</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Note that `conda search tensorflow-gpu` can be used to see which versions of `tensorflow-gpu` are available with conda. If the version you would like to install is not available in your conda channels, you can either specify a different channel or install everything manually with `pip`—see [release history](https://pypi.org/project/tensorflow-gpu/#history) for `tensorflow-gpu`.

## Usage [TODO: TEST THIS SECTION]

### Overview

DeepPicker is a trainable particle picker, that when presented coordinate files of particles along with the micrographs of origin, can produce new `.h5` files that DeepPicker can then operate by to make refined picks. 

Thus, the desired application is important:
- To pick by the general model that DeepPicker comes with, skip to the [Pick using pretrained model](#pick-using-pretrained-model) section.
- To train a new model and then pick with that model, start by [Training a new model](#training-a-new-model), then [Pick using pretrained model](#pick-using-pretrained-model) (but substitute the `pre_trained_model` parameter with the name of the newly created model, which will be a `.h5` file).

`.h5` file refers to a HDF5 format, which is a binary data format container for large arrays of data; this is an easy format for the NumPy module in python - which DeepPicker uses - to decipher. It works in DeepPicker's case to store particle information to identify. 

### Training a new model

#### Specifics

**File formatting:** DeepPicker has a very strict format of `.star` files that it can comprehend. Our script [TODO], which converts `.box` ground truth coordinate files from EMPIAR into readable `.star` files, may be of help. For context, `.star` files are text-based file formats for storing data, essentially containing the titles and collections of data in text. 

**File location:** The `.star` files *in proper format* have to be in the same folder as the micrographs they correspond to.

**File naming:** The `.star` files also have to have the same name as the corresponding `.mrc` file, except with an identifying suffix at the end (e.g., the micrograph `Falcon_2012_06_12-15_27_22_0.mrc` would correspond with the coordinate file `Falcon_2012_06_12-15_27_22_0_cnnPick.star`, as there is a suffix at the end; the suffix string will be identified in the script command for training for DeepPicker)

#### Running training

Assuming the aforementioned specifics are met, the following command will create a new model, with tailoring of parameters. Parameters outlined below as well.

Note: Command is directory-specific for location of `train.py` and the inputDir; running the command below necessitates being in the same directory as `train.py`, otherwise specify the folder (folder location is specified below for from cryodocs/). 

```shell script
python pickers/deeppicker/train.py --train_type 1 --train_inputDir "input_dir" --particle_size 160 --mrc_number -1 --particle_number -1 --coordinate_symbol 'some_string' --model_save_dir 'output_dir' --model_save_file 'output_model_name'
</code></pre></div></div> <p>Parameters</p> <ul> <li><code class="language-plaintext highlighter-rouge">--train_inputDir</code>: input directory of <code class="language-plaintext highlighter-rouge">.star</code> and corresponding <code class="language-plaintext highlighter-rouge">.mrc</code> files</li> <li><code class="language-plaintext highlighter-rouge">--train_type</code>: options are 1, 2, 3, or 4. 1 is recommended, for specimen-specific new models; 2 for multiple molecules, 3 for iterative training.</li> <li><code class="language-plaintext highlighter-rouge">--mrc_number</code>: number of <code class="language-plaintext highlighter-rouge">.mrc</code> files to pick from the directory specified; default=-1 refers to all</li> <li><code class="language-plaintext highlighter-rouge">--particle_size</code>: the size of the particle</li> <li><code class="language-plaintext highlighter-rouge">--coordinate_symbol</code>: suffix that identifies <code class="language-plaintext highlighter-rouge">.star</code> file for each <code class="language-plaintext highlighter-rouge">.mrc</code> file; refer [Specifics]</li> <li><code class="language-plaintext highlighter-rouge">--model_save_dir</code>: the directory to save the model <code class="language-plaintext highlighter-rouge">.h5</code> file to</li> <li><code class="language-plaintext highlighter-rouge">--model_save_file</code>: the name of the model <code class="language-plaintext highlighter-rouge">.h5</code> file</li> </ul> <h3 id="pick-using-pretrained-model"> <a href="#pick-using-pretrained-model" class="anchor-heading" aria-labelledby="pick-using-pretrained-model"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pick using pretrained model </h3> <p>Start by collecting the micrograph files (<code class="language-plaintext highlighter-rouge">*.mrc</code>) to be picked in a directory (assuming they are not already available in their own directory). If you would like to use an existing public data set, <a href="/docs/empiar.html">our guide to the EMPIAR database</a> may be helpful.</p> <p>```shell script mkdir -p name_of_data_set/mrc mv path/to/your_mrc_files/*.mrc name_of_data_set/mrc</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Here we will use the micrographs located in `demo_data/` as an example. Create another directory, in which any output, temporary, or configuration files will be saved by the picker.

```shell script
mkdir demo_data/deeppicker_out
</code></pre></div></div> <p>Use the following command to pick all micrographs in <code class="language-plaintext highlighter-rouge">demo_data/mrc/</code>. A description of parameters is given below. Note: Command is again directory-specific for <code class="language-plaintext highlighter-rouge">autoPick.py</code>; you need to be in the same directory as autoPick.py or specify the folder location (folder location is specified below for from cryodocs/).</p> <p><code class="language-plaintext highlighter-rouge">shell script python pickers/deeppicker/autoPick.py --inputDir 'demo_data/mrc/' --pre_trained_model 'pretrained_or_created_model' --particle_size 176 --mrc_number -1 --outputDir 'demo_data/deepicker_out' --coordinate_symbol '_dp' --threshold 0.5 </code></p> <p>Parameters</p> <ul> <li><code class="language-plaintext highlighter-rouge">--inputDir</code>: input directory of <code class="language-plaintext highlighter-rouge">.mrc</code> files</li> <li><code class="language-plaintext highlighter-rouge">--pre_trained_model</code>: the <code class="language-plaintext highlighter-rouge">.h5</code> model file</li> <li><code class="language-plaintext highlighter-rouge">--mrc_number</code>: number of <code class="language-plaintext highlighter-rouge">.mrc</code> files to pick from the directory specified; default=-1 refers to all</li> <li><code class="language-plaintext highlighter-rouge">--particle_size</code>: the size of the particle</li> <li><code class="language-plaintext highlighter-rouge">--outputDir</code>: output directory to save the coordinate <code class="language-plaintext highlighter-rouge">.star</code> files</li> <li><code class="language-plaintext highlighter-rouge">--coordinate_symbol</code>: suffix to be appended to the filenames of the output coordinate files (e.g., the input micrograph <code class="language-plaintext highlighter-rouge">Falcon_2012_06_12-15_27_22_0.mrc</code> would correspond with an output coordinate file named <code class="language-plaintext highlighter-rouge">Falcon_2012_06_12-15_27_22_0_cnnPick.star</code>)</li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
