<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>ASPIRE APPLEpicker - cryo-docs</title> <link rel="shortcut icon" href="/cryo-docs/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/cryo-docs/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/cryo-docs/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/cryo-docs/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.6.1 --> <title>ASPIRE APPLEpicker | cryo-docs</title> <meta name="generator" content="Jekyll v3.9.0" /> <meta property="og:title" content="ASPIRE APPLEpicker" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="/cryo-docs/aspire-apple.html" /> <meta property="og:url" content="/cryo-docs/aspire-apple.html" /> <meta property="og:site_name" content="cryo-docs" /> <script type="application/ld+json"> {"url":"/cryo-docs/aspire-apple.html","headline":"ASPIRE APPLEpicker","@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/cryo-docs/" class="site-title lh-tight"> cryo-docs </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/cryo-docs/" class="nav-list-link">Home</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/cryo-docs/pickers" class="nav-list-link">Particle Pickers</a><ul class="nav-list "><li class="nav-list-item active"><a href="/cryo-docs/aspire-apple.html" class="nav-list-link active">ASPIRE APPLEpicker</a></li><li class="nav-list-item "><a href="/cryo-docs/autocryopicker.html" class="nav-list-link">AutoCryoPicker</a></li><li class="nav-list-item "><a href="/cryo-docs/deeppicker.html" class="nav-list-link">DeepPicker</a></li><li class="nav-list-item "><a href="/cryo-docs/relion-log.html" class="nav-list-link">RELION LoG (Laplacian-of-Gaussian) Picker</a></li><li class="nav-list-item "><a href="/cryo-docs/sphire-cryolo.html" class="nav-list-link">SPHIRE-crYOLO</a></li><li class="nav-list-item "><a href="/cryo-docs/topaz.html" class="nav-list-link">Topaz</a></li></ul></li><li class="nav-list-item"><a href="/cryo-docs/empiar.html" class="nav-list-link">EMPIAR</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search cryo-docs" aria-label="Search cryo-docs" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/sebseager/cryo-docs" class="site-button" > cryo-docs on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/cryo-docs/pickers">Particle Pickers</a></li> <li class="breadcrumb-nav-list-item"><span>ASPIRE APPLEpicker</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="aspire-applepicker"> <a href="#aspire-applepicker" class="anchor-heading" aria-labelledby="aspire-applepicker"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ASPIRE APPLEpicker </h1> <h2 id="summary"> <a href="#summary" class="anchor-heading" aria-labelledby="summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Summary </h2> <p>ASPIRE (which includes APPLEpicker) is available as a set of conda-installable Python modules. We used Python 3.7 for this installation.</p> <p>There are several versions of APPLEpickerâ€”a <a href="https://github.com/PrincetonUniversity/APPLEpicker-python">standalone Python version</a>, a <a href="https://github.com/PrincetonUniversity/APPLEpicker">standalone MATLAB version</a>, and an implementation within <a href="https://github.com/ComputationalCryoEM/ASPIRE-Python">the ASPIRE project for Python</a>.</p> <p>The standalone version(s) seem to have been deprecated, according to one of the collaborators <a href="https://github.com/PrincetonUniversity/APPLEpicker/issues/1#issuecomment-525574243">here</a>. Therefore, the following document refers only to APPLEpicker as included in the ASPIRE-Python project.</p> <p>The APPLEpicker paper can be found <a href="https://doi.org/10.1016/j.jsb.2018.08.012">here</a>. Refer also to the ASPIRE <a href="https://computationalcryoem.github.io/ASPIRE-Python/">wiki</a> for more information. The following guide is drawn in part from these resources.</p> <h2 id="installation"> <a href="#installation" class="anchor-heading" aria-labelledby="installation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installation </h2> <p>ASPIRE must be installed into its own conda environment. It can be obtained either as a pip-installable package or via its git repository. Because this guide includes several patches, it will follow the latter method.</p> <p>First, clone the ASPIRE repo into <code class="language-plaintext highlighter-rouge">pickers/aspire/</code> using</p> <p>```shell script git clone https://github.com/ComputationalCryoEM/ASPIRE-Python.git pickers/aspire</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
During the course of our experiments, we have created a set of patches for APPLEpicker. If you would like to apply these changes, run the patch script included in `cryo-docs/patches/aspire`. This script will replace `apple.py`, `helper.py`, and `picking.py` in the `pickers/aspire/src/aspire/apple/` directory with our patched versions.

```shell script
sh patches/aspire/patch-aspire.sh pickers/aspire/
</code></pre></div></div> <p>Create a new conda environment containing the packages in the included <code class="language-plaintext highlighter-rouge">environment.yml</code> file.</p> <p>```shell script conda env create -f pickers/aspire/environment.yml conda activate aspire</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
The new environment will be named `aspire` by default (as specified in the environment file), but `-n your_name_here` can be added to the `conda env create` command to change this name.

The ASPIRE README recommends running their provided unit tests before installing. (Note that due to modifications made to the APPLEpicker source by our patch script above, the `testPickCenters` unit test may fail. The rest of the tests should pass with a handful of `FutureWarning`s, `DeprecationWarning`s, etc.)

```shell script
(cd pickers/aspire &amp;&amp; PYTHONPATH=./src pytest tests)
</code></pre></div></div> <p>In case the above does not work, a second unit test method is also provided, though it appears that it may become deprecated in future.</p> <p>```shell script (cd pickers/aspire &amp;&amp; python setup.py test)</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Install ASPIRE to the active conda environment (make sure you run `conda activate aspire` first, if you have not already done so).

```shell script
(cd pickers/aspire &amp;&amp; python setup.py install)
</code></pre></div></div> <h2 id="usage"> <a href="#usage" class="anchor-heading" aria-labelledby="usage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Usage </h2> <h3 id="overview"> <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview </h3> <p>Inputs</p> <ul> <li>micrographs for which to pick particles</li> <li>particle size, tau1, tau2, and other configurable parameters</li> </ul> <p>Outputs</p> <ul> <li>directory containing <code class="language-plaintext highlighter-rouge">*.star</code> coordinate files</li> </ul> <h3 id="setup"> <a href="#setup" class="anchor-heading" aria-labelledby="setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setup </h3> <h3 id="configuration"> <a href="#configuration" class="anchor-heading" aria-labelledby="configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Configuration </h3> <p>[TODO: SORT OUT ASPIRE CONFIG CMD, and/or whether config.ini is read from conda package (doesnâ€™t seem like it)]</p> <p>There are several configurable parameters hard-coded in <code class="language-plaintext highlighter-rouge">pickers/aspire/src/aspire/config.ini</code>, including the following. [TODO: FIGURE OUT DEFINITIONS FOR EACH IF POSSIBLE]</p> <ul> <li><code class="language-plaintext highlighter-rouge">particle_size</code> (default: 78)</li> <li><code class="language-plaintext highlighter-rouge">query_image_size</code> (default: 52)</li> <li><code class="language-plaintext highlighter-rouge">max_particle_size</code> (default: 156)</li> <li><code class="language-plaintext highlighter-rouge">min_particle_size</code> (default: 19)</li> <li><code class="language-plaintext highlighter-rouge">tau1</code> (default: 710): percentage of training images believed to contain a particle</li> <li><code class="language-plaintext highlighter-rouge">tau2</code> (default: 7100): percentage of training images believed may <em>potentially</em> contain a particle</li> </ul> <h3 id="picking"> <a href="#picking" class="anchor-heading" aria-labelledby="picking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Picking </h3> <p>Start by collecting the micrograph files (<code class="language-plaintext highlighter-rouge">*.mrc</code>) to be picked in a directory (assuming they are not already available in their own directory). If you would like to use an existing public data set, <a href="/cryo-docs/empiar.html">our guide to the EMPIAR database</a> may be helpful.</p> <p>```shell script mkdir -p name_of_data_set/mrc mv path/to/your_mrc_files/*.mrc name_of_data_set/mrc</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
Here we will use the micrographs located in `demo_data/` as an example. Create another directory, in which any output, temporary, or configuration files will be saved by the picker.

```shell script
mkdir demo_data/apple_out
</code></pre></div></div> <p>To pick particles for every micrograph in <code class="language-plaintext highlighter-rouge">demo_data/mrc/</code>, run</p> <p>```shell script python -m aspire apple â€“mrc_dir demo_data/mrc/ â€“output_dir demo_data/apple_out/</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
or, to pick a single micrograph only, run

```shell script
python -m aspire apple --mrc_file demo_data/mrc/your_micrograph.mrc --output_dir demo_data/apple_out/
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">--create_jpg</code> flag can be appended to either of the <code class="language-plaintext highlighter-rouge">python -m aspire apple</code> commands above to generate and save images of the micrograph(s) with particle detections overlayed.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
